$(document).ready(function(){function o(){t=new Date,i=t.getTime()-e.getTime(),$("#chrono").text(Math.round(i/10)/100),r=setTimeout(o,10)}$("#jsKO").hide(),$("#circuit").css("background","url(images/"+parcours+".png)"),$("#popup").css("background","url(images/"+parcours+".png)"),$.fn.contact&&$("#contact").contact();var e,t,r,c=new RegExp(","),s=!1,i=0,n=[0,0];const u={init:function(){return localStorage.getItem("sourisRecords")||localStorage.setItem("sourisRecords",JSON.stringify({})),JSON.parse(localStorage.getItem("sourisRecords"))},saveRecord:function(o,e){let t=this.init();return(!t[o]||t[o]>e)&&(t[o]=e,localStorage.setItem("sourisRecords",JSON.stringify(t)),!0)},getRecord:function(o){let e=this.init();return e[o]||null}},a=u.getRecord(parcours);a?$("#personal-record").show().text("Ton record personnel : "+a+" s"):$("#personal-record").hide(),$("#circuit").on("mousedown",function(o){s&&(o.stopPropagation(),clearTimeout(r),$("#circuit").css("cursor","auto"),s=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))}),$("#popup input").on("click",function(){$("#popup").hide(),$("#circuit").show()}),$("#circuit").on("mousemove",function(c){c.stopPropagation();var a=$("#circuit").offset(),p=Math.round(c.pageX-a.left),d=c.pageY-$("#circuit").scrollTop(),l=0;if(void 0!==zBitmap[p]&&void 0!==zBitmap[p][d]&&(l=zBitmap[p][d]),s||1!=l||(s=!0,e=new Date,o(),n=[p,d],$("#circuit").css("cursor","url(images/coccinelle.cur), pointer")),s){var h=Math.sqrt(Math.pow(Math.abs(n[0]-p),2)+Math.pow(Math.abs(n[1]-d),2));if(h<400){if(n=[p,d],0==l)clearTimeout(r),$("#circuit").css("cursor","auto"),s=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange");else if(3==l){clearTimeout(r),$("#circuit").css("cursor","auto"),t=new Date,i=t.getTime()-e.getTime(),s=!1;const o=i/1e3,c=u.saveRecord(parcours,o);c&&$("#personal-record").show().text("Ton record personnel : "+o+" s"),$.post("ajax/key.php",{chrono:i/10,token:sessionToken},function(o){$.post("ajax/record.php",{parcours:parcours,pseudo:pilote,chrono:i/10,key:o,token:sessionToken},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())})}),$("#chrono").text(i/1e3),$("#circuit").hide(),$("#popup").show().find("h1").html("Bravo !<br/>Tu as r√©ussi en "+i/1e3+" s"+(c?"<br/><span class='new-record'>Nouveau record personnel !</span>":"")).css("backgroundColor","green")}}else clearTimeout(r),$("#circuit").css("cursor","auto"),s=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange")}}),$("#jsOK").on("mousemove",function(){s&&(clearTimeout(r),$("#circuit").css("cursor","auto"),s=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))});var p=function(){$("#jsOK").hide(),$("#getPseudo").show(),$("#getPseudo input[type=text]").val(pilote).focus()};$("#getPseudo input[type=button]").on("click",function(){pilote=$.trim($("#getPseudo input[type=text]").val()),null!=pilote&&pilote.length>=4&&!pilote.match(c)&&($("#pseudo").text("["+pilote+"]"),$("#getPseudo").hide(),$("#jsOK").show())}),$("#pseudo").on("click",function(){p()}),$("#aide").on("click",function(){$("#jsOK").hide(),$("#consignes").show()}),$("#retour").on("click",function(){$("#consignes").hide(),$("#jsOK").show()}),$(".changer").on("click",function(){$(this).attr("href",$(this).attr("href")+"&p="+pilote)}),$.post("ajax/record.php",{parcours:parcours},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())}),pilote.length<4||pilote.match(c)?(pilote="Anonyme",p()):($("#getPseudo").hide(),$("#jsOK").show(),$("#pseudo").text("["+pilote+"]"))});