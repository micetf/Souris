$(document).ready(function(){function o(){t=new Date,u=t.getTime()-e.getTime(),$("#chrono").text(Math.round(u/10)/100),c=setTimeout(o,10)}$("#jsKO").hide(),$("#circuit").css("background","url(images/"+parcours+".png)"),$("#popup").css("background","url(images/"+parcours+".png)"),$("#contact").contact();var e,t,c,r=new RegExp(","),i=!1,u=0,s=new Array(0,0);$("#circuit").mousedown(function(o){i&&(o.stopPropagation(),clearTimeout(c),$("#circuit").css("cursor","auto"),i=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))}),$("#popup input").click(function(){$("#popup").hide(),$("#circuit").show()}),$("#circuit").mousemove(function(r){r.stopPropagation();var a=$("#circuit").offset();delta_x=Math.round(r.pageX-a.left),delta_y=r.pageY-$("#circuit").scrollTop();var n=0;if(null!=zBitmap[delta_x]&&null!=zBitmap[delta_x][delta_y]&&(n=zBitmap[delta_x][delta_y]),i||1!=n||(i=!0,e=new Date,o(),s=new Array(delta_x,delta_y),$("#circuit").css("cursor","url(images/coccinelle.cur), pointer")),i){var p=Math.sqrt(Math.pow(Math.abs(s[0]-delta_x),2)+Math.pow(Math.abs(s[1]-delta_y),2));p<400?(s=new Array(delta_x,delta_y),0==n?(clearTimeout(c),$("#circuit").css("cursor","auto"),i=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange")):3==n&&(clearTimeout(c),$("#circuit").css("cursor","auto"),t=new Date,u=t.getTime()-e.getTime(),i=!1,$.post("ajax/key.php",{chrono:u/10},function(o){$.post("ajax/record.php",{parcours:parcours,pseudo:pilote,chrono:u/10,key:o},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())})}),$("#chrono").text(u/1e3),$("#circuit").hide(),$("#popup").show().find("h1").html("Bravo !<br/>Tu as rÃ©ussi en "+u/1e3+" s").css("backgroundColor","green"))):(clearTimeout(c),$("#circuit").css("cursor","auto"),i=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))}}),$("#jsOK").mousemove(function(){i&&(clearTimeout(c),$("#circuit").css("cursor","auto"),i=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))});var a=function(){$("#jsOK").hide(),$("#getPseudo").show(),$("#getPseudo input[type=text]").val(pilote).focus()};$("#getPseudo input[type=button]").click(function(){pilote=$.trim($("#getPseudo input[type=text]").val()),null!=pilote&&pilote.length>=4&&!pilote.match(r)&&($("#pseudo").text("["+pilote+"]"),$("#getPseudo").hide(),$("#jsOK").show())}),$("#pseudo").click(function(){a()}),$("#aide").click(function(){$("#jsOK").hide(),$("#consignes").show()}),$("#retour").click(function(){$("#consignes").hide(),$("#jsOK").show()}),$(".changer").click(function(){$(this).attr("href",$(this).attr("href")+"&p="+pilote)}),$.post("ajax/record.php",{parcours:parcours},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())}),pilote.length<4||pilote.match(r)?(pilote="Anonyme",a()):($("#getPseudo").hide(),$("#jsOK").show(),$("#pseudo").text("["+pilote+"]"))});