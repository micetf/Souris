$(document).ready(function(){function o(){t=new Date,s=t.getTime()-e.getTime(),$("#chrono").text(Math.round(s/10)/100),c=setTimeout(o,10)}$("#jsKO").hide(),$("#circuit").css("background","url(images/"+parcours+".png)"),$("#popup").css("background","url(images/"+parcours+".png)"),$.fn.contact&&$("#contact").contact();var e,t,c,i=new RegExp(","),r=!1,s=0,u=[0,0];$("#circuit").on("mousedown",function(o){r&&(o.stopPropagation(),clearTimeout(c),$("#circuit").css("cursor","auto"),r=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))}),$("#popup input").on("click",function(){$("#popup").hide(),$("#circuit").show()}),$("#circuit").on("mousemove",function(i){i.stopPropagation();var n=$("#circuit").offset(),p=Math.round(i.pageX-n.left),a=i.pageY-$("#circuit").scrollTop(),h=0;if(void 0!==zBitmap[p]&&void 0!==zBitmap[p][a]&&(h=zBitmap[p][a]),r||1!=h||(r=!0,e=new Date,o(),u=[p,a],$("#circuit").css("cursor","url(images/coccinelle.cur), pointer")),r){var d=Math.sqrt(Math.pow(Math.abs(u[0]-p),2)+Math.pow(Math.abs(u[1]-a),2));d<400?(u=[p,a],0==h?(clearTimeout(c),$("#circuit").css("cursor","auto"),r=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange")):3==h&&(clearTimeout(c),$("#circuit").css("cursor","auto"),t=new Date,s=t.getTime()-e.getTime(),r=!1,$.post("ajax/key.php",{chrono:s/10,token:sessionToken},function(o){$.post("ajax/record.php",{parcours:parcours,pseudo:pilote,chrono:s/10,key:o,token:sessionToken},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())})}),$("#chrono").text(s/1e3),$("#circuit").hide(),$("#popup").show().find("h1").html("Bravo !<br/>Tu as rÃ©ussi en "+s/1e3+" s").css("backgroundColor","green"))):(clearTimeout(c),$("#circuit").css("cursor","auto"),r=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))}}),$("#jsOK").on("mousemove",function(){r&&(clearTimeout(c),$("#circuit").css("cursor","auto"),r=!1,$("#circuit").hide(),$("#popup").show().find("h1").html("Perdu !").css("backgroundColor","orange"))});var n=function(){$("#jsOK").hide(),$("#getPseudo").show(),$("#getPseudo input[type=text]").val(pilote).focus()};$("#getPseudo input[type=button]").on("click",function(){pilote=$.trim($("#getPseudo input[type=text]").val()),null!=pilote&&pilote.length>=4&&!pilote.match(i)&&($("#pseudo").text("["+pilote+"]"),$("#getPseudo").hide(),$("#jsOK").show())}),$("#pseudo").on("click",function(){n()}),$("#aide").on("click",function(){$("#jsOK").hide(),$("#consignes").show()}),$("#retour").on("click",function(){$("#consignes").hide(),$("#jsOK").show()}),$(".changer").on("click",function(){$(this).attr("href",$(this).attr("href")+"&p="+pilote)}),$.post("ajax/record.php",{parcours:parcours},function(o){""!=$.trim(o)?($("#records ol").show().empty().append(o),$("#records ul").hide()):($("#records ol").hide(),$("#records ul").show())}),pilote.length<4||pilote.match(i)?(pilote="Anonyme",n()):($("#getPseudo").hide(),$("#jsOK").show(),$("#pseudo").text("["+pilote+"]"))});